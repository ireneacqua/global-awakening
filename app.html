<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Awakening Platform</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; overflow-x: hidden; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Storage wrapper per localStorage
        window.storage = {
            async get(key, shared = false) {
                const value = localStorage.getItem(key);
                return value ? { key, value, shared } : null;
            },
            
            async set(key, value, shared = false) {
                localStorage.setItem(key, value);
                return { key, value, shared };
            },
            
            async delete(key, shared = false) {
                localStorage.removeItem(key);
                return { key, deleted: true, shared };
            }
        };

        // Icone Lucide come componenti React semplici
        const Star = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>;
        const Users = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>;
        const Calendar = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>;
        const Clock = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>;
        const MessageCircle = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>;
        const Send = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>;
        const Brain = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"></path><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"></path></svg>;
        const MapPin = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>;
        const Bell = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>;
        const Zap = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>;
        const CheckCircle = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>;
        const Languages = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m5 8 6 6"></path><path d="m4 14 6-6 2-3"></path><path d="M2 5h12"></path><path d="M7 2h1"></path><path d="m22 22-5-10-5 10"></path><path d="M14 18h6"></path></svg>;
        const RefreshCw = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>;
        const Trophy = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path></svg>;
        const AlertCircle = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>;
        const Eye = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>;
        const Sparkles = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path><path d="M5 3v4"></path><path d="M19 17v4"></path><path d="M3 5h4"></path><path d="M17 19h4"></path></svg>;
      const translations = {
          en: {
            title: "Global Awakening",
            subtitle: "Unite in Light, Awaken as One",
            enterPlatform: "Enter Platform",
            nicknamePrompt: "Choose a nickname (optional)",
            nicknamePlaceholder: "Leave empty for anonymous...",
            stats: {
              activeRituals: "Active Rituals",
              onlineNow: "Online Now",
              nextRitual: "Next Ritual"
            },
            tabs: {
              rituals: "Rituals",
              map: "Map",
              astral: "Telepathy",
              community: "Community",
              chat: "Chat"
            },
            profile: {
              anonymous: "Anonymous",
              nickname: "Nickname",
              location: "Location (optional)",
              hideLocation: "Hide my location",
              type: "Starseed Type",
              telepathyScore: "Telepathy Score",
              saveChanges: "Save",
              yourProfile: "Your Profile"
            },
            map: {
              title: "Global Starseed Network",
              subtitle: "Anonymous stars awakening together",
              totalVisible: "visible starseeds"
            },
            astral: {
              title: "Telepathy Training",
              subtitle: "Develop your psychic abilities",
              symbolMatch: {
                title: "Symbol Telepathy",
                description: "Practice telepathy with another starseed. One sends, one receives.",
                yourScore: "Your Score",
                bestScore: "Best Score",
                waitingForPartner: "Waiting for partner...",
                partnerFound: "Partner found!",
                findPartner: "Find Partner",
                cancelSearch: "Cancel",
                instructions: "Instructions",
                step1: "Click 'Find Partner' to connect with another starseed",
                step2: "One becomes SENDER (chooses symbol), one becomes RECEIVER (perceives it)",
                step3: "Compare results - each match earns you both points!",
                selectSymbol: "SENDER: Select the symbol you're transmitting",
                receiveSymbol: "RECEIVER: Which symbol do you perceive?",
                transmitting: "Transmitting...",
                receiving: "Receiving...",
                sendButton: "Send Telepathically",
                receiveButton: "Submit Perception",
                waitingForSender: "Waiting for sender to choose...",
                waitingForReceiver: "Waiting for receiver to respond...",
                match: "âœ¨ TELEPATHIC MATCH! âœ¨",
                noMatch: "Keep practicing! You'll improve.",
                youSent: "Sent",
                partnerSent: "Partner sent",
                youReceived: "Received",
                partnerReceived: "Partner received",
                tryAgain: "Try Again",
                newPartner: "Find New Partner",
                chooseRole: "Choose your role",
                sender: "I am SENDER",
                receiver: "I am RECEIVER",
                bothEarned: "You both earned",
                points: "points"
              },
              groupMind: {
                title: "Group Mind",
                description: "Share thoughts with the collective consciousness",
                participants: "participants",
                share: "Share Thought",
                placeholder: "What are you perceiving..."
              },
              dreamLink: {
                title: "Dream Link",
                description: "Share astral experiences",
                intention: "Tonight I intend to meet fellow starseeds in the astral realm",
                share: "Share Dream",
                placeholder: "Describe your astral experience...",
                recent: "Recent Dreams"
              }
            },
            chat: {
              title: "Global Chat",
              subtitle: "Connect with starseeds worldwide",
              placeholder: "Share your message with the community...",
              send: "Send",
              online: "online now",
              noMessages: "No messages yet. Be the first to say something!",
              startChat: "Start a conversation with the community..."
            },
            community: {
              title: "Community",
              online: "starseeds present"
            },
            ritualTypes: {
              consciousness: { label: "Consciousness", icon: "ðŸ§ " },
              dna: { label: "DNA", icon: "ðŸ§¬" },
              lightbody: { label: "Light Body", icon: "âœ¨" },
              veil: { label: "Veil", icon: "ðŸŒŸ" },
              unity: { label: "Unity", icon: "ðŸ¤" },
              ascension: { label: "Ascension", icon: "ðŸŒ…" }
            },
            createRitual: {
              button: "Propose Ritual",
              title: "Propose Ritual",
              titlePlaceholder: "Ritual title...",
              descriptionPlaceholder: "Description...",
              dateLabel: "Date",
              timeLabel: "Time (UTC)",
              durationLabel: "Min",
              createButton: "Create",
              cancelButton: "Cancel"
            },
            numerology: {
              1: "Unity", 3: "Trinity", 7: "Mystic", 9: "Complete",
              11: "Master", 12: "Cosmic", 22: "Builder", 33: "Teacher",
              44: "Healer", 108: "Sacred"
            },
            ritualCard: {
              by: "by",
              participants: "joined",
              timeUntil: "in",
              join: "Join",
              joined: "Joined",
              energy: "Energy",
              live: "Live",
              ended: "Ended"
            }
          },
          it: {
            title: "Risveglio Globale",
            subtitle: "Uniti nella Luce, Risvegliati come Uno",
            enterPlatform: "Entra",
            nicknamePrompt: "Scegli un nickname (opzionale)",
            nicknamePlaceholder: "Lascia vuoto per anonimo...",
            stats: {
              activeRituals: "Rituali Attivi",
              onlineNow: "Online Ora",
              nextRitual: "Prossimo"
            },
            tabs: {
              rituals: "Rituali",
              map: "Mappa",
              astral: "Telepatia",
              community: "Community",
              chat: "Chat"
            },
            profile: {
              anonymous: "Anonimo",
              nickname: "Nickname",
              location: "Posizione (opzionale)",
              hideLocation: "Nascondi posizione",
              type: "Tipo",
              telepathyScore: "Punteggio Telepatico",
              saveChanges: "Salva",
              yourProfile: "Tuo Profilo"
            },
            map: {
              title: "Rete Globale",
              subtitle: "Stelle anonime che si risvegliano",
              totalVisible: "starseeds visibili"
            },
            astral: {
              title: "Allenamento Telepatico",
              subtitle: "Sviluppa le tue capacitÃ  psichiche",
              symbolMatch: {
                title: "Telepatia con Simboli",
                description: "Pratica la telepatia con un altro starseed. Uno trasmette, uno riceve.",
                yourScore: "Tuo Punteggio",
                bestScore: "Record",
                waitingForPartner: "Cercando partner...",
                partnerFound: "Partner trovato!",
                findPartner: "Trova Partner",
                cancelSearch: "Annulla",
                instructions: "Istruzioni",
                step1: "Clicca 'Trova Partner' per connetterti con un altro starseed",
                step2: "Uno diventa TRASMETTITORE (sceglie simbolo), uno RICEVITORE (lo percepisce)",
                step3: "Confrontate i risultati - ogni match vi fa guadagnare punti!",
                selectSymbol: "TRASMETTITORE: Seleziona il simbolo che stai trasmettendo",
                receiveSymbol: "RICEVITORE: Quale simbolo percepisci?",
                transmitting: "Trasmettendo...",
                receiving: "Ricevendo...",
                sendButton: "Trasmetti Telepaticamente",
                receiveButton: "Invia Percezione",
                waitingForSender: "Aspettando che il trasmettitore scelga...",
                waitingForReceiver: "Aspettando la risposta del ricevitore...",
                match: "âœ¨ MATCH TELEPATICO! âœ¨",
                noMatch: "Continua a praticare! Migliorerai.",
                youSent: "Inviato",
                partnerSent: "Partner ha inviato",
                youReceived: "Ricevuto",
                partnerReceived: "Partner ha ricevuto",
                tryAgain: "Riprova",
                newPartner: "Trova Nuovo Partner",
                chooseRole: "Scegli il tuo ruolo",
                sender: "Sono TRASMETTITORE",
                receiver: "Sono RICEVITORE",
                bothEarned: "Avete guadagnato",
                points: "punti"
              },
              groupMind: {
                title: "Mente Collettiva",
                description: "Condividi pensieri con la coscienza collettiva",
                participants: "partecipanti",
                share: "Condividi",
                placeholder: "Cosa stai percependo..."
              },
              dreamLink: {
                title: "Link dei Sogni",
                description: "Condividi esperienze astrali",
                intention: "Stanotte intendo incontrare altri starseeds nel regno astrale",
                share: "Condividi",
                placeholder: "Descrivi la tua esperienza...",
                recent: "Sogni Recenti"
              }
            },
            chat: {
              title: "Chat Globale",
              subtitle: "Connettiti con starseeds in tutto il mondo",
              placeholder: "Condividi il tuo messaggio con la community...",
              send: "Invia",
              online: "online ora",
              noMessages: "Nessun messaggio ancora. Sii il primo a dire qualcosa!",
              startChat: "Inizia una conversazione con la community..."
            },
            community: {
              title: "Community",
              online: "starseeds presenti"
            },
            ritualTypes: {
              consciousness: { label: "Coscienza", icon: "ðŸ§ " },
              dna: { label: "DNA", icon: "ðŸ§¬" },
              lightbody: { label: "Luce", icon: "âœ¨" },
              veil: { label: "Velo", icon: "ðŸŒŸ" },
              unity: { label: "UnitÃ ", icon: "ðŸ¤" },
              ascension: { label: "Ascensione", icon: "ðŸŒ…" }
            },
            createRitual: {
              button: "Proponi Rituale",
              title: "Proponi Rituale",
              titlePlaceholder: "Titolo rituale...",
              descriptionPlaceholder: "Descrizione...",
              dateLabel: "Data",
              timeLabel: "Ora (UTC)",
              durationLabel: "Min",
              createButton: "Crea",
              cancelButton: "Annulla"
            },
            numerology: {
              1: "UnitÃ ", 3: "TrinitÃ ", 7: "Mistico", 9: "Completo",
              11: "Maestro", 12: "Cosmico", 22: "Costruttore", 33: "Insegnante",
              44: "Guaritore", 108: "Sacro"
            },
            ritualCard: {
              by: "di",
              participants: "uniti",
              timeUntil: "tra",
              join: "Unisciti",
              joined: "Unito",
              energy: "Energia",
              live: "Live",
              ended: "Finito"
            }
          }
        };

        const telepathySymbols = [
          { id: 'star', icon: 'â­', name: 'Star' },
          { id: 'sun', icon: 'â˜€ï¸', name: 'Sun' },
          { id: 'moon', icon: 'ðŸŒ™', name: 'Moon' },
          { id: 'heart', icon: 'ðŸ’œ', name: 'Heart' },
          { id: 'eye', icon: 'ðŸ‘ï¸', name: 'Eye' },
          { id: 'infinity', icon: 'âˆž', name: 'Infinity' }
        ];
      function GlobalAwakeningPlatform() {
          const [lang, setLang] = useState('en');
          const [activeTab, setActiveTab] = useState('rituals');
          const [rituals, setRituals] = useState([]);
          const [onlineUsers, setOnlineUsers] = useState([]);
          const [nickname, setNickname] = useState('');
          const [tempNickname, setTempNickname] = useState('');
          const [showNicknamePrompt, setShowNicknamePrompt] = useState(true);
          const [country, setCountry] = useState('');
          const [city, setCity] = useState('');
          const [hideLocation, setHideLocation] = useState(true);
          const [starseedType, setStarseedType] = useState('Unknown');
          const [showCreateRitual, setShowCreateRitual] = useState(false);
          const [showProfileEdit, setShowProfileEdit] = useState(false);
          
          const [telepathyScore, setTelepathyScore] = useState(0);
          const [bestScore, setBestScore] = useState(0);
          
          const [chatMessages, setChatMessages] = useState([]);
          const [newChatMessage, setNewChatMessage] = useState('');
          const [telepathicMessage, setTelepathicMessage] = useState('');
          const [groupThoughts, setGroupThoughts] = useState([]);
          const [dreamLog, setDreamLog] = useState([]);
          const [newDream, setNewDream] = useState('');
          
          const [newRitual, setNewRitual] = useState({
            title: '',
            description: '',
            date: '',
            time: '',
            duration: 30,
            type: 'consciousness',
            sacredNumber: 11
          });

          const t = translations[lang];
          const sessionId = useRef(Date.now() + Math.random());

          useEffect(() => {
            loadData();
            const interval = setInterval(loadData, 3000);
            return () => clearInterval(interval);
          }, []);

          useEffect(() => {
            const loadProfile = async () => {
              try {
                const profileData = await window.storage.get('user_profile');
                if (profileData) {
                  const profile = JSON.parse(profileData.value);
                  setNickname(profile.nickname || '');
                  setStarseedType(profile.starseedType || 'Unknown');
                  setCountry(profile.country || '');
                  setCity(profile.city || '');
                  setHideLocation(profile.hideLocation !== false);
                  setTelepathyScore(profile.telepathyScore || 0);
                  setBestScore(profile.bestScore || 0);
                }
              } catch (error) {}
              
              const savedScore = localStorage.getItem('telepathy_score');
              const savedBest = localStorage.getItem('telepathy_best');
              if (savedScore && !nickname) setTelepathyScore(parseInt(savedScore));
              if (savedBest && !nickname) setBestScore(parseInt(savedBest));
            };
            
            loadProfile();
          }, []);

          useEffect(() => {
            const updatePresence = async () => {
              const presence = {
                id: sessionId.current,
                nickname: nickname || t.profile.anonymous,
                type: starseedType,
                country: hideLocation ? '' : country,
                city: hideLocation ? '' : city,
                lastSeen: Date.now()
              };
              
              try {
                const presenceData = await window.storage.get('online_presence', true);
                let allPresence = presenceData ? JSON.parse(presenceData.value) : [];
                allPresence = allPresence.filter(p => Date.now() - p.lastSeen < 120000);
                
                const index = allPresence.findIndex(p => p.id === sessionId.current);
                if (index >= 0) {
                  allPresence[index] = presence;
                } else {
                  allPresence.push(presence);
                }
                
                await window.storage.set('online_presence', JSON.stringify(allPresence), true);
                setOnlineUsers(allPresence);
              } catch (error) {}
            };

            updatePresence();
            const presenceInterval = setInterval(updatePresence, 10000);
            return () => clearInterval(presenceInterval);
          }, [nickname, starseedType, country, city, hideLocation, t.profile.anonymous]);

          const loadData = async () => {
            try {
              const ritualsData = await window.storage.get('awakening_rituals', true);
              if (ritualsData) setRituals(JSON.parse(ritualsData.value));
            } catch (error) {}

            try {
              const thoughtsData = await window.storage.get('group_thoughts', true);
              if (thoughtsData) setGroupThoughts(JSON.parse(thoughtsData.value));
            } catch (error) {}

            try {
              const dreamsData = await window.storage.get('dream_logs', true);
              if (dreamsData) setDreamLog(JSON.parse(dreamsData.value));
            } catch (error) {}

            try {
              const chatData = await window.storage.get('global_chat', true);
              if (chatData) setChatMessages(JSON.parse(chatData.value));
            } catch (error) {}

            try {
              const presenceData = await window.storage.get('online_presence', true);
              if (presenceData) {
                let allPresence = JSON.parse(presenceData.value);
                allPresence = allPresence.filter(p => Date.now() - p.lastSeen < 120000);
                setOnlineUsers(allPresence);
                await window.storage.set('online_presence', JSON.stringify(allPresence), true);
              }
            } catch (error) {}
          };

          const handleEnter = () => {
            setNickname(tempNickname || '');
            setShowNicknamePrompt(false);
          };

          const handleCreateRitual = async () => {
            if (newRitual.title && newRitual.date && newRitual.time) {
              const ritual = {
                id: Date.now(),
                proposer: nickname || t.profile.anonymous,
                proposerType: starseedType,
                ...newRitual,
                participants: [],
                energy: 0,
                createdAt: new Date().toISOString()
              };

              const updatedRituals = [...rituals, ritual];
              setRituals(updatedRituals);
              await window.storage.set('awakening_rituals', JSON.stringify(updatedRituals), true);
              
              setNewRitual({
                title: '',
                description: '',
                date: '',
                time: '',
                duration: 30,
                type: 'consciousness',
                sacredNumber: 11
              });
              setShowCreateRitual(false);
            }
          };

          const handleJoinRitual = async (ritualId) => {
            const updatedRituals = rituals.map(ritual => {
              if (ritual.id === ritualId) {
                const alreadyJoined = ritual.participants.some(p => p.id === sessionId.current);
                if (!alreadyJoined) {
                  return {
                    ...ritual,
                    participants: [...ritual.participants, { 
                      id: sessionId.current, 
                      nickname: nickname || t.profile.anonymous, 
                      type: starseedType 
                    }],
                    energy: ritual.energy + 1
                  };
                }
              }
              return ritual;
            });
            
            setRituals(updatedRituals);
            await window.storage.set('awakening_rituals', JSON.stringify(updatedRituals), true);
          };

          const handleSendEnergy = async (ritualId) => {
            const updatedRituals = rituals.map(ritual => 
              ritual.id === ritualId ? { ...ritual, energy: ritual.energy + 10 } : ritual
            );
            setRituals(updatedRituals);
            await window.storage.set('awakening_rituals', JSON.stringify(updatedRituals), true);
          };

          const handleSendChatMessage = async () => {
            if (newChatMessage.trim()) {
              const message = {
                id: Date.now(),
                user: nickname || t.profile.anonymous,
                type: starseedType,
                sessionId: sessionId.current,
                content: newChatMessage,
                timestamp: new Date().toISOString()
              };
              const updated = [...chatMessages, message].slice(-100);
              setChatMessages(updated);
              await window.storage.set('global_chat', JSON.stringify(updated), true);
              setNewChatMessage('');
            }
          };

          const handleShareThought = async () => {
            if (telepathicMessage.trim()) {
              const thought = {
                id: Date.now(),
                user: nickname || t.profile.anonymous,
                type: starseedType,
                message: telepathicMessage,
                timestamp: new Date().toISOString()
              };
              const updated = [thought, ...groupThoughts].slice(0, 20);
              setGroupThoughts(updated);
              await window.storage.set('group_thoughts', JSON.stringify(updated), true);
              setTelepathicMessage('');
            }
          };

          const handleShareDream = async () => {
            if (newDream.trim()) {
              const dream = {
                id: Date.now(),
                user: nickname || t.profile.anonymous,
                type: starseedType,
                content: newDream,
                timestamp: new Date().toISOString()
              };
              const updated = [dream, ...dreamLog].slice(0, 30);
              setDreamLog(updated);
              await window.storage.set('dream_logs', JSON.stringify(updated), true);
              setNewDream('');
            }
          };

          const starseedTypes = [
            { name: 'Pleiadian', icon: 'âœ¨' },
            { name: 'Sirian', icon: 'ðŸŒŸ' },
            { name: 'Arcturian', icon: 'ðŸ’«' },
            { name: 'Andromedan', icon: 'ðŸŒ ' },
            { name: 'Lyran', icon: 'â­' },
            { name: 'Orion', icon: 'ðŸŒŒ' },
            { name: 'Unknown', icon: 'ðŸŒ' }
          ];

          const sacredNumbers = [1, 3, 7, 9, 11, 12, 22, 33, 44, 108];

          const getTimeUntil = (date, time) => {
            const ritualDate = new Date(`${date}T${time}`);
            const now = new Date();
            const diff = ritualDate - now;
            
            if (diff < 0) {
              if (diff > -3600000) return t.ritualCard.live;
              return t.ritualCard.ended;
            }
            
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            
            if (hours > 0) return `${hours}h ${minutes}m`;
            return `${minutes}m`;
          };

          if (showNicknamePrompt) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 flex items-center justify-center p-4">
                <div className="absolute top-4 right-4">
                  <button
                    onClick={() => setLang(lang === 'en' ? 'it' : 'en')}
                    className="px-4 py-2 bg-white/10 backdrop-blur-lg rounded-xl text-white hover:bg-white/20 transition-all border border-white/20 text-sm"
                  >
                    {lang === 'en' ? 'IT' : 'EN'}
                  </button>
                </div>
                
                <div className="bg-white/10 backdrop-blur-lg rounded-3xl p-8 max-w-md w-full shadow-2xl border border-white/20">
                  <div className="text-center mb-8">
                    <Star className="w-24 h-24 mx-auto mb-4 text-yellow-300" style={{animation: 'pulse 2s infinite'}} />
                    <h1 className="text-4xl font-bold text-white mb-2">{t.title}</h1>
                    <p className="text-purple-200 text-sm">{t.subtitle}</p>
                  </div>

                  <div className="space-y-4">
                    <div>
                      <label className="block text-white mb-2 font-medium text-sm">{t.nicknamePrompt}</label>
                      <input
                        type="text"
                        value={tempNickname}
                        onChange={(e) => setTempNickname(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && handleEnter()}
                        className="w-full px-4 py-3 rounded-xl bg-white/20 border border-white/30 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-purple-400"
                        placeholder={t.nicknamePlaceholder}
                      />
                    </div>
                    
                    <button
                      onClick={handleEnter}
                      className="w-full bg-gradient-to-r from-purple-500 via-pink-500 to-yellow-500 text-white py-4 rounded-xl font-bold text-lg hover:shadow-2xl transition-all hover:scale-105"
                    >
                      {t.enterPlatform}
                    </button>

                    <p className="text-purple-300 text-xs text-center">
                      {lang === 'en' 
                        ? 'No registration required. Enter and leave freely.' 
                        : 'Nessuna registrazione richiesta. Entra ed esci liberamente.'}
                    </p>
                  </div>
                </div>
              </div>
            );
          }

          return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900' },
            React.createElement('header', { className: 'bg-white/10 backdrop-blur-lg border-b border-white/20 sticky top-0 z-50' },
              React.createElement('div', { className: 'max-w-7xl mx-auto px-4 py-3' },
                React.createElement('div', { className: 'flex items-center justify-between' },
                  React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement(Star, { className: 'w-8 h-8 text-yellow-300' }),
                    React.createElement('div', null,
                      React.createElement('h1', { className: 'text-xl font-bold text-white' }, t.title),
                      React.createElement('p', { className: 'text-purple-200 text-xs' }, t.subtitle)
                    )
                  ),
                  React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement('button', {
                      onClick: () => setLang(lang === 'en' ? 'it' : 'en'),
                      className: 'px-3 py-2 bg-white/10 rounded-xl text-white hover:bg-white/20 transition-all text-sm'
                    }, lang === 'en' ? 'IT' : 'EN'),
                    React.createElement('button', {
                      onClick: () => setShowProfileEdit(true),
                      className: 'flex items-center gap-2 bg-white/10 px-3 py-2 rounded-xl hover:bg-white/20 transition-all'
                    },
                      React.createElement('div', { className: 'text-2xl' }, starseedTypes.find(type => type.name === starseedType)?.icon),
                      React.createElement('div', { className: 'text-white font-medium text-sm' }, nickname || t.profile.anonymous)
                    )
                  )
                )
              )
            ),
            
            React.createElement('div', { className: 'max-w-7xl mx-auto px-4 py-3' },
              React.createElement('div', { className: 'bg-gradient-to-r from-purple-500/20 via-pink-500/20 to-yellow-500/20 backdrop-blur-lg rounded-2xl p-3 border border-white/20' },
                React.createElement('div', { className: 'grid grid-cols-3 gap-4 text-center' },
                  React.createElement('div', null,
                    React.createElement('div', { className: 'text-2xl font-bold text-white' }, rituals.length),
                    React.createElement('div', { className: 'text-purple-200 text-xs' }, t.stats.activeRituals)
                  ),
                  React.createElement('div', null,
                    React.createElement('div', { className: 'text-2xl font-bold text-white' }, onlineUsers.length),
                    React.createElement('div', { className: 'text-purple-200 text-xs' }, t.stats.onlineNow)
                  ),
                  React.createElement('div', null,
                    React.createElement('div', { className: 'text-lg font-bold text-yellow-300' }, telepathyScore),
                    React.createElement('div', { className: 'text-purple-200 text-xs' }, t.profile.telepathyScore)
                  )
                )
              )
            ),

            React.createElement('div', { className: 'max-w-7xl mx-auto px-4 pt-2' },
              React.createElement('div', { className: 'flex gap-1 bg-white/10 backdrop-blur-lg rounded-2xl p-1 overflow-x-auto' },
                ['rituals', 'chat', 'community'].map((tab) =>
                  React.createElement('button', {
                    key: tab,
                    onClick: () => setActiveTab(tab),
                    className: `flex-1 py-2 px-2 rounded-xl font-medium transition-all text-sm whitespace-nowrap ${activeTab === tab ? 'bg-white/20 text-white shadow-lg' : 'text-purple-200 hover:bg-white/10'}`
                  }, t.tabs[tab])
                )
              )
            ),

            React.createElement('div', { className: 'max-w-7xl mx-auto px-4 py-4' },
              activeTab === 'rituals' && React.createElement('div', { className: 'space-y-4' },
                React.createElement('div', { className: 'bg-white/10 rounded-2xl p-12 text-center' },
                  React.createElement(Star, { className: 'w-16 h-16 mx-auto mb-4 text-yellow-300' }),
                  React.createElement('p', { className: 'text-white' }, 'Platform ready! Features coming soon...')
                )
              ),
              activeTab === 'chat' && React.createElement('div', { className: 'bg-white/10 backdrop-blur-lg rounded-2xl border border-white/20' },
                React.createElement('div', { className: 'p-4 border-b border-white/20' },
                  React.createElement('h2', { className: 'text-2xl font-bold text-white mb-1' }, t.chat.title),
                  React.createElement('p', { className: 'text-purple-200 text-sm' }, t.chat.subtitle)
                )
              ),
              activeTab === 'community' && React.createElement('div', { className: 'bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20' },
                React.createElement('h2', { className: 'text-2xl font-bold text-white mb-4' }, t.community.title),
                React.createElement('div', { className: 'text-purple-200 mb-4' }, `${onlineUsers.length} ${t.community.online}`)
              )
            )
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(GlobalAwakeningPlatform));
    </script>
</body>
</html>
